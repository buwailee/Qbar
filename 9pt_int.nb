(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.3' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     94604,       2488]
NotebookOptionsPosition[     92630,       2452]
NotebookOutlinePosition[     93082,       2469]
CellTagsIndexPosition[     93039,       2466]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "pre", " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"1", "+", "1"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"n", "=", "9"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"ParallelTable", "[", 
     RowBox[{"i", ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "5"}], "}"}]}], "]"}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"AppendTo", "[", 
     RowBox[{"$Path", ",", 
      RowBox[{"NotebookDirectory", "[", "]"}]}], "]"}], ";"}]}]}]], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.776488870230817*^9, 3.7764888954950185`*^9}, {
  3.778476797284091*^9, 3.778476798023755*^9}, {3.7987865696258836`*^9, 
  3.798786570095014*^9}, {3.798787587242628*^9, 3.798787587854899*^9}, {
  3.798787776229635*^9, 3.7987877765995393`*^9}},
 CellLabel->"In[6]:=",ExpressionUUID->"769c0147-5afc-472b-a0ef-dcc203a2118d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"basic", " ", "fun"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"cyc", "=", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"i", "\[Rule]", 
         RowBox[{"i", "+", "1"}]}], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "n"}], "}"}]}], "]"}], "/.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"n", "+", "1"}], "\[Rule]", "1"}], "}"}]}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cyclic", "[", "exp_", "]"}], ":=", 
    RowBox[{"NestList", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{"#", "/.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{"R", "[", "x__", "]"}], "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"R", "[", "x", "]"}], "/.", "cyc"}], ")"}]}], ",", 
           RowBox[{
            RowBox[{"ab", "[", "x__", "]"}], "\[RuleDelayed]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{"ab", "[", "x", "]"}], "/.", "cyc"}], ")"}]}]}], 
          "}"}]}], ")"}], "&"}], ",", "exp", ",", 
      RowBox[{"n", "-", "1"}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sixR", "[", 
     RowBox[{"a_", ",", "b_", ",", "c_", ",", "d_", ",", "e_", ",", "f_"}], 
     "]"}], ":=", 
    RowBox[{
     RowBox[{"R", "[", 
      RowBox[{"a", ",", "b", ",", "c", ",", "d", ",", "f"}], "]"}], "+", 
     RowBox[{"R", "[", 
      RowBox[{"a", ",", "b", ",", "c", ",", "f", ",", "e"}], "]"}], "+", 
     RowBox[{"R", "[", 
      RowBox[{"a", ",", "b", ",", "d", ",", "e", ",", "f"}], "]"}], "+", 
     RowBox[{"R", "[", 
      RowBox[{"a", ",", "c", ",", "d", ",", "f", ",", "e"}], "]"}], "+", 
     RowBox[{"R", "[", 
      RowBox[{"b", ",", "c", ",", "d", ",", "e", ",", "f"}], "]"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"ordercup", "[", "exp_", "]"}], ":=", 
     RowBox[{"SortBy", "[", 
      RowBox[{"exp", ",", 
       RowBox[{
        RowBox[{"Which", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"Head", "[", "#", "]"}], "===", "cap"}], ",", "1.5", ",", 
          RowBox[{
           RowBox[{"Head", "[", "#", "]"}], "===", "shift"}], ",", "1.4", ",",
           "True", ",", "#"}], "]"}], "&"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sortR", "=", 
     RowBox[{"{", 
      RowBox[{"i_R", ":>", 
       RowBox[{
        RowBox[{"ordercup", "[", "i", "]"}], 
        RowBox[{
         RowBox[{"Signature", "[", "i", "]"}], "/", 
         RowBox[{"Signature", "[", 
          RowBox[{"ordercup", "[", "i", "]"}], "]"}]}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sortab", "=", 
     RowBox[{"{", 
      RowBox[{"i_ab", "\[RuleDelayed]", 
       RowBox[{
        RowBox[{"ordercup", "[", "i", "]"}], 
        RowBox[{
         RowBox[{"Signature", "[", "i", "]"}], "/", 
         RowBox[{"Signature", "[", 
          RowBox[{"ordercup", "[", "i", "]"}], "]"}]}]}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Zs", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Binomial", "[", 
        RowBox[{
         RowBox[{"n", "+", "i"}], ",", "i"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "20"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "3"}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"randomPositiveZs", "[", "n_", "]"}], ":=", 
    RowBox[{"(", 
     RowBox[{
      RowBox[{"Zs", "=", 
       RowBox[{"Nest", "[", 
        RowBox[{
         RowBox[{"Function", "[", 
          RowBox[{
           RowBox[{"{", "mat", "}"}], ",", 
           RowBox[{"Block", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"hatted", "=", 
                RowBox[{"Append", "[", 
                 RowBox[{
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Append", "[", 
                    RowBox[{
                    RowBox[{"Total", "[", 
                    RowBox[{"mat", "\[LeftDoubleBracket]", 
                    RowBox[{"#1", ";;", 
                    RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}], "]"}], 
                    ",", "1"}], "]"}], "&"}], ")"}], "/@", 
                   RowBox[{"Range", "[", 
                    RowBox[{"2", ",", 
                    RowBox[{"Length", "[", "mat", "]"}]}], "]"}]}], ",", 
                  RowBox[{"Append", "[", 
                   RowBox[{
                    RowBox[{"PadRight", "[", 
                    RowBox[{
                    RowBox[{"{", "}"}], ",", 
                    RowBox[{"Length", "[", 
                    RowBox[{
                    "mat", "\[LeftDoubleBracket]", "1", 
                    "\[RightDoubleBracket]"}], "]"}]}], "]"}], ",", "1"}], 
                   "]"}]}], "]"}]}], ",", 
               RowBox[{"newRow", "=", 
                RowBox[{"RandomInteger", "[", 
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{"1", ",", "10"}], "}"}], ",", 
                  RowBox[{"{", 
                   RowBox[{"Length", "[", "mat", "]"}], "}"}]}], "]"}]}]}], 
              "}"}], ",", 
             RowBox[{"newRow", " ", "hatted"}]}], "]"}]}], "]"}], ",", 
         RowBox[{"RandomInteger", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"1", ",", "10"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"n", "+", "8"}], ",", "1"}], "}"}]}], "]"}], ",", "3"}], 
        "]"}]}], ";", 
      RowBox[{"Zs", "=", 
       RowBox[{
        RowBox[{"Transpose", "[", 
         RowBox[{
          RowBox[{"Inverse", "[", 
           RowBox[{"Transpose", "[", 
            RowBox[{"Zs", "\[LeftDoubleBracket]", 
             RowBox[{"{", 
              RowBox[{"1", ",", "2", ",", "3", ",", "4"}], "}"}], 
             "\[RightDoubleBracket]"}], "]"}], "]"}], ".", 
          RowBox[{"Transpose", "[", "Zs", "]"}]}], "]"}], 
        "\[LeftDoubleBracket]", 
        RowBox[{"5", ";;", 
         RowBox[{"-", "1"}]}], "\[RightDoubleBracket]"}]}], ";"}], ")"}]}], 
   "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"neabp", "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"exp", "/.", "\[VeryThinSpace]", "shifexp"}], "//.", 
       "\[VeryThinSpace]", "capexpand"}], "/.", "\[VeryThinSpace]", 
      RowBox[{
       RowBox[{"ab", "[", "x__", "]"}], "\[RuleDelayed]", 
       RowBox[{"Det", "[", 
        RowBox[{"Zs", "\[LeftDoubleBracket]", 
         RowBox[{"{", "x", "}"}], "\[RightDoubleBracket]"}], "]"}]}]}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"ab", "[", 
      RowBox[{"___", ",", "j_", ",", "___", ",", "j_", ",", "___"}], "]"}], ":=",
      "0"}], ";"}], "\n", 
   RowBox[{
    RowBox[{"sortdoubleab", "=", 
     RowBox[{"{", 
      RowBox[{"i_doubleab", "\[RuleDelayed]", 
       RowBox[{
        RowBox[{"Sort", "[", "i", "]"}], 
        RowBox[{
         RowBox[{"Signature", "[", "i", "]"}], "/", 
         RowBox[{"Signature", "[", 
          RowBox[{"Sort", "[", "i", "]"}], "]"}]}]}]}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"sortcapinR", "=", 
     RowBox[{
      RowBox[{"R", "[", "a__", "]"}], "\[RuleDelayed]", 
      RowBox[{"R", "@@", 
       RowBox[{"(", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"List", "[", "a", "]"}], ",", 
          RowBox[{
           RowBox[{"cap", "[", 
            RowBox[{"x_", ",", "y_"}], "]"}], ":>", 
           RowBox[{"cap", "[", 
            RowBox[{
             RowBox[{"ordercup", "@", "x"}], ",", 
             RowBox[{"ordercup", "[", "y", "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "Infinity"}], "}"}]}], "]"}], ")"}]}]}]}], ";"}],
    "\n", 
   RowBox[{
    RowBox[{"capexpand", " ", "=", " ", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ab", "[", 
        RowBox[{"x___", ",", " ", 
         RowBox[{"cap", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"a_", ",", " ", "b_"}], "}"}], ",", " ", 
           RowBox[{"{", "c__", "}"}]}], "]"}], ",", " ", "y___"}], "]"}], " ",
        ":>", " ", 
       RowBox[{
        RowBox[{
         RowBox[{"ab", "[", 
          RowBox[{"b", ",", " ", "c"}], "]"}], " ", 
         RowBox[{"ab", "[", 
          RowBox[{"x", ",", " ", "a", ",", " ", "y"}], "]"}]}], " ", "+", " ", 
        RowBox[{
         RowBox[{"ab", "[", 
          RowBox[{"c", ",", " ", "a"}], "]"}], " ", 
         RowBox[{"ab", "[", 
          RowBox[{"x", ",", " ", "b", ",", " ", "y"}], "]"}]}]}]}], "}"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"shifexp", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ab", "[", 
        RowBox[{"x___", ",", 
         RowBox[{"shift", "[", 
          RowBox[{"y_", ",", "z_"}], "]"}], ",", "w___"}], "]"}], ":>", 
       RowBox[{
        RowBox[{"ab", "[", 
         RowBox[{"x", ",", 
          RowBox[{"y", "\[LeftDoubleBracket]", "1", "\[RightDoubleBracket]"}],
           ",", "w"}], "]"}], "+", 
        RowBox[{"z", " ", 
         RowBox[{"ab", "[", 
          RowBox[{"x", ",", 
           RowBox[{
           "y", "\[LeftDoubleBracket]", "2", "\[RightDoubleBracket]"}], ",", 
           "w"}], "]"}]}]}]}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"mom", "=", 
     RowBox[{"RandomInteger", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "100"}], ",", "100"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"20", ",", "4"}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"mom1", "=", 
     RowBox[{"Table", "[", 
      RowBox[{
       RowBox[{"Binomial", "[", 
        RowBox[{
         RowBox[{"n", "+", "i"}], ",", "i"}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"n", ",", "20"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"i", ",", "0", ",", "3"}], "}"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"neab", "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"exp", "/.", "shifexp"}], "//.", "capexpand"}], "/.", 
      RowBox[{
       RowBox[{"ab", "[", "x__", "]"}], "\[RuleDelayed]", 
       RowBox[{"Det", "[", 
        RowBox[{"mom", "[", 
         RowBox[{"[", 
          RowBox[{"{", "x", "}"}], "]"}], "]"}], "]"}]}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"neab1", "[", "exp_", "]"}], ":=", 
     RowBox[{
      RowBox[{
       RowBox[{"exp", "/.", "shifexp"}], "//.", "capexpand"}], "/.", 
      RowBox[{
       RowBox[{"ab", "[", "x__", "]"}], "\[RuleDelayed]", 
       RowBox[{"Det", "[", 
        RowBox[{"mom1", "[", 
         RowBox[{"[", 
          RowBox[{"{", "x", "}"}], "]"}], "]"}], "]"}]}]}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"sortcapinR", "=", 
     RowBox[{
      RowBox[{"R", "[", "a__", "]"}], "\[RuleDelayed]", 
      RowBox[{"R", "@@", 
       RowBox[{"(", 
        RowBox[{"Replace", "[", 
         RowBox[{
          RowBox[{"List", "[", "a", "]"}], ",", 
          RowBox[{
           RowBox[{"cap", "[", 
            RowBox[{"x_", ",", "y_"}], "]"}], ":>", 
           RowBox[{"cap", "[", 
            RowBox[{
             RowBox[{"ordercup", "@", "x"}], ",", 
             RowBox[{"ordercup", "[", "y", "]"}]}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", "Infinity"}], "}"}]}], "]"}], ")"}]}]}]}], ";"}],
    "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"cap1tocap", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ab", "[", 
        RowBox[{"a_", ",", 
         RowBox[{"cap1", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"b_", ",", "c_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"d_", ",", "e_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"f_", ",", "g_"}], "}"}]}], "]"}]}], "]"}], 
       "\[RuleDelayed]", 
       RowBox[{"ab", "[", 
        RowBox[{
         RowBox[{"cap", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"b", ",", "c"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"a", ",", "f", ",", "g"}], "}"}]}], "]"}], ",", "a", ",", 
         "d", ",", "e"}], "]"}]}], "}"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"cap1exp", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ab", "[", 
        RowBox[{"a_", ",", 
         RowBox[{"cap1", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"b_", ",", "c_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"d_", ",", "e_"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"f_", ",", "g_"}], "}"}]}], "]"}]}], "]"}], 
       "\[RuleDelayed]", 
       RowBox[{
        RowBox[{
         RowBox[{"ab", "[", 
          RowBox[{"a", ",", "b", ",", "d", ",", "e"}], "]"}], 
         RowBox[{"ab", "[", 
          RowBox[{"a", ",", "c", ",", "f", ",", "g"}], "]"}]}], "-", 
        RowBox[{
         RowBox[{"ab", "[", 
          RowBox[{"a", ",", "b", ",", "f", ",", "g"}], "]"}], 
         RowBox[{"ab", "[", 
          RowBox[{"a", ",", "c", ",", "d", ",", "e"}], "]"}]}]}]}], "}"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"tocaps", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"-", 
          RowBox[{"ab", "[", "a__", "]"}]}], 
         RowBox[{"ab", "[", "b__", "]"}]}], "+", 
        RowBox[{
         RowBox[{"ab", "[", "c__", "]"}], 
         RowBox[{"ab", "[", "d__", "]"}]}]}], "\[RuleDelayed]", 
       "\[IndentingNewLine]", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"deg2", "=", 
            RowBox[{"Intersection", "[", 
             RowBox[{
              RowBox[{"{", "a", "}"}], ",", 
              RowBox[{"{", "b", "}"}], ",", 
              RowBox[{"{", "c", "}"}], ",", 
              RowBox[{"{", "d", "}"}]}], "]"}]}], ",", 
           RowBox[{"hh", "=", 
            RowBox[{"Tally", "/@", 
             RowBox[{"Transpose", "@", 
              RowBox[{"Select", "[", 
               RowBox[{
                RowBox[{"Flatten", "[", 
                 RowBox[{
                  RowBox[{"Outer", "[", 
                   RowBox[{"List", ",", 
                    RowBox[{"{", "a", "}"}], ",", 
                    RowBox[{"{", "b", "}"}]}], "]"}], ",", "1"}], "]"}], ",", 
                RowBox[{
                 RowBox[{"!", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{"SubsetQ", "[", 
                    RowBox[{
                    RowBox[{"{", "c", "}"}], ",", "#"}], "]"}], "||", 
                    RowBox[{"SubsetQ", "[", 
                    RowBox[{
                    RowBox[{"{", "d", "}"}], ",", "#"}], "]"}]}], ")"}]}], 
                 "&"}]}], "]"}]}]}]}]}], "}"}], ",", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"neab1", "[", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{"#", "-", 
                  RowBox[{"(", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"ab", "[", "a", "]"}]}], 
                    RowBox[{"ab", "[", "b", "]"}]}], "+", 
                    RowBox[{
                    RowBox[{"ab", "[", "c", "]"}], 
                    RowBox[{"ab", "[", "d", "]"}]}]}], ")"}]}], ")"}], "/.", 
                "cap1exp"}], "]"}], "===", "0"}], ",", "#", ",", 
             RowBox[{"-", "#"}]}], "]"}], "&"}], "@", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"deg2", "===", 
             RowBox[{"{", "}"}]}], ",", "\[IndentingNewLine]", 
            RowBox[{"(", 
             RowBox[{
              RowBox[{
               RowBox[{"ab", "[", 
                RowBox[{
                 RowBox[{"cap", "[", 
                  RowBox[{
                   RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
                   RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
                 RowBox[{"Sequence", "@@", 
                  RowBox[{"#", "[", 
                   RowBox[{"[", "4", "]"}], "]"}]}]}], "]"}], "&"}], "@", 
              RowBox[{"Flatten", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{
                  RowBox[{"{", 
                   RowBox[{
                    RowBox[{"First", "/@", 
                    RowBox[{"Select", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Last", "[", "#", "]"}], "\[Equal]", "1"}], 
                    "&"}]}], "]"}]}], ",", 
                    RowBox[{"First", "/@", 
                    RowBox[{"Select", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Last", "[", "#", "]"}], "\[Equal]", "3"}], 
                    "&"}]}], "]"}]}]}], "}"}], "&"}], "/@", "hh"}], ",", 
                "1"}], "]"}]}], ")"}], ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"Length", "[", "deg2", "]"}], "===", "1"}], ",", 
              "\[IndentingNewLine]", 
              RowBox[{
               RowBox[{
                RowBox[{"ab", "[", 
                 RowBox[{
                  RowBox[{"First", "[", "deg2", "]"}], ",", 
                  RowBox[{"cap1", "[", 
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", 
                    RowBox[{"3", ",", "1"}], "]"}], "]"}]}], "}"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "4", "]"}], "]"}], ",", 
                    RowBox[{"#", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}], "]"}], "&"}], 
               "@", 
               RowBox[{"Flatten", "[", 
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"First", "/@", 
                    RowBox[{"Select", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Last", "[", "#", "]"}], "\[Equal]", "1"}], 
                    "&"}]}], "]"}]}], ",", 
                    RowBox[{"First", "/@", 
                    RowBox[{"Select", "[", 
                    RowBox[{"#", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Last", "[", "#", "]"}], "\[Equal]", "2"}], 
                    "&"}]}], "]"}]}]}], "}"}], "&"}], "/@", "hh"}], ")"}], 
                 ",", "1"}], "]"}]}], ",", 
              RowBox[{"twistorSimplify", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"-", 
                  RowBox[{"ab", "[", "a", "]"}]}], 
                 RowBox[{"ab", "[", "b", "]"}]}], "+", 
                RowBox[{
                 RowBox[{"ab", "[", "c", "]"}], 
                 RowBox[{"ab", "[", "d", "]"}]}]}], "]"}]}], "]"}]}], 
           "\[IndentingNewLine]", "]"}]}]}], "]"}]}], "}"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"sortcap1", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ab", "[", 
        RowBox[{"a_", ",", 
         RowBox[{"cap1", "[", 
          RowBox[{"b_", ",", "c_", ",", "d_"}], "]"}]}], "]"}], 
       "\[RuleDelayed]", 
       RowBox[{
        RowBox[{"ab", "[", 
         RowBox[{"a", ",", 
          RowBox[{"cap1", "@@", 
           RowBox[{"SortBy", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{
               RowBox[{"Sort", "[", "b", "]"}], ",", 
               RowBox[{"Sort", "[", "c", "]"}], ",", 
               RowBox[{"Sort", "[", "d", "]"}]}], "}"}], ",", "First"}], 
            "]"}]}]}], "]"}], 
        RowBox[{"Signature", "[", "b", "]"}], 
        RowBox[{"Signature", "[", "c", "]"}], 
        RowBox[{"Signature", "[", "d", "]"}], 
        RowBox[{"Signature", "[", 
         RowBox[{"SortBy", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{
             RowBox[{"Sort", "[", "b", "]"}], ",", 
             RowBox[{"Sort", "[", "c", "]"}], ",", 
             RowBox[{"Sort", "[", "d", "]"}]}], "}"}], ",", "First"}], "]"}], 
         "]"}], 
        RowBox[{"Signature", "[", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"Sort", "[", "b", "]"}], ",", 
           RowBox[{"Sort", "[", "c", "]"}], ",", 
           RowBox[{"Sort", "[", "d", "]"}]}], "}"}], "]"}]}]}], "}"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"sixR", "[", 
     RowBox[{"a_", ",", "b_", ",", "c_", ",", "d_", ",", "e_", ",", "f_"}], 
     "]"}], ":=", 
    RowBox[{
     RowBox[{"R", "[", 
      RowBox[{"a", ",", "b", ",", "c", ",", "d", ",", "f"}], "]"}], "+", 
     RowBox[{"R", "[", 
      RowBox[{"a", ",", "b", ",", "c", ",", "f", ",", "e"}], "]"}], "+", 
     RowBox[{"R", "[", 
      RowBox[{"a", ",", "b", ",", "d", ",", "e", ",", "f"}], "]"}], "+", 
     RowBox[{"R", "[", 
      RowBox[{"a", ",", "c", ",", "d", ",", "f", ",", "e"}], "]"}], "+", 
     RowBox[{"R", "[", 
      RowBox[{"b", ",", "c", ",", "d", ",", "e", ",", "f"}], "]"}]}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tocap2", "=", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"ab", "[", 
        RowBox[{"z___", ",", 
         RowBox[{"cap", "[", 
          RowBox[{"x_", ",", "y_"}], "]"}], ",", "w___"}], "]"}], 
       "\[RuleDelayed]", 
       RowBox[{"(", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{"(", 
            RowBox[{
             RowBox[{"neab", "[", 
              RowBox[{"#", "/.", "expandcap2"}], "]"}], "/", 
             RowBox[{"neab", "[", 
              RowBox[{"ab", "[", 
               RowBox[{"z", ",", 
                RowBox[{"cap", "[", 
                 RowBox[{"x", ",", "y"}], "]"}], ",", "w"}], "]"}], "]"}]}], 
            ")"}], "#"}], "&"}], "[", 
         RowBox[{"ab", "[", 
          RowBox[{
           RowBox[{"Sequence", "@@", 
            RowBox[{"(", 
             RowBox[{"Sort", "[", "x", "]"}], ")"}]}], ",", 
           RowBox[{"cap2", "@@", 
            RowBox[{"(", 
             RowBox[{"SortBy", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"Sort", "[", "y", "]"}], ",", 
                 RowBox[{"Sort", "[", 
                  RowBox[{"{", 
                   RowBox[{"z", ",", "w"}], "}"}], "]"}]}], "}"}], ",", 
               "First"}], "]"}], ")"}]}]}], "]"}], "]"}], ")"}]}], "}"}]}], 
    ";"}], "\n", 
   RowBox[{
    RowBox[{"expandcap2", "=", 
     RowBox[{
      RowBox[{"ab", "[", 
       RowBox[{"a___", ",", 
        RowBox[{"cap2", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"c_", ",", "d_", ",", "e_"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"f_", ",", "g_", ",", "h_"}], "}"}]}], "]"}], ",", 
        "b___"}], "]"}], "\[RuleDelayed]", 
      RowBox[{
       RowBox[{
        RowBox[{"ab", "[", 
         RowBox[{"a", ",", "c", ",", "d", ",", "b"}], "]"}], 
        RowBox[{"ab", "[", 
         RowBox[{"e", ",", "f", ",", "g", ",", "h"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"ab", "[", 
         RowBox[{"a", ",", "d", ",", "e", ",", "b"}], "]"}], 
        RowBox[{"ab", "[", 
         RowBox[{"c", ",", "f", ",", "g", ",", "h"}], "]"}]}], "+", 
       RowBox[{
        RowBox[{"ab", "[", 
         RowBox[{"a", ",", "e", ",", "c", ",", "b"}], "]"}], 
        RowBox[{"ab", "[", 
         RowBox[{"d", ",", "f", ",", "g", ",", "h"}], "]"}]}]}]}]}], ";"}], 
   "\n", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"order", "[", 
      RowBox[{"exprn_", ",", 
       RowBox[{"option_", ":", "1"}]}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{"option", "\[Equal]", "0"}], ",", 
       RowBox[{"exprn", "/.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{"ab", "[", "x__", "]"}], "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"Signature", "[", 
            RowBox[{"{", "x", "}"}], "]"}], " ", 
           RowBox[{"ab", "@@", 
            RowBox[{"Sort", "[", 
             RowBox[{"{", "x", "}"}], "]"}]}]}]}], "}"}]}], ",", 
       RowBox[{"Block", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"nGuess", "=", 
            RowBox[{"Max", "[", 
             RowBox[{"Join", "[", 
              RowBox[{
               RowBox[{"{", "0", "}"}], ",", 
               RowBox[{"Flatten", "[", 
                RowBox[{"Apply", "[", 
                 RowBox[{"List", ",", 
                  RowBox[{"Cases", "[", 
                   RowBox[{"exprn", ",", "_ab", ",", 
                    RowBox[{"{", 
                    RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}], ",", 
                  RowBox[{"{", "1", "}"}]}], "]"}], "]"}]}], "]"}], "]"}]}], 
           ",", "consec", ",", "xLike"}], "}"}], ",", 
         RowBox[{
          RowBox[{"consec", "=", 
           RowBox[{"Partition", "[", 
            RowBox[{
             RowBox[{"Range", "[", "nGuess", "]"}], ",", "2", ",", "1", ",", 
             "1"}], "]"}]}], ";", 
          RowBox[{"xLike", "=", 
           RowBox[{"Apply", "[", 
            RowBox[{
             RowBox[{
              RowBox[{"If", "[", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"Range", "[", 
                   RowBox[{"#2", ",", "#3"}], "]"}], "]"}], ">", 
                 RowBox[{"Length", "[", 
                  RowBox[{"Range", "[", 
                   RowBox[{"#4", ",", 
                    RowBox[{"#1", "+", "nGuess"}]}], "]"}], "]"}]}], ",", 
                RowBox[{"{", 
                 RowBox[{"#3", ",", "#4", ",", "#1", ",", "#2"}], "}"}], ",", 
                RowBox[{"{", "##1", "}"}]}], "]"}], "&"}], ",", 
             RowBox[{"Select", "[", 
              RowBox[{
               RowBox[{"Flatten", "/@", 
                RowBox[{"Subsets", "[", 
                 RowBox[{"consec", ",", 
                  RowBox[{"{", "2", "}"}]}], "]"}]}], ",", 
               RowBox[{
                RowBox[{
                 RowBox[{"Length", "[", 
                  RowBox[{"#1", "\[Intersection]", "#1"}], "]"}], "\[Equal]", 
                 "4"}], "&"}]}], "]"}], ",", 
             RowBox[{"{", "1", "}"}]}], "]"}]}], ";", 
          RowBox[{"exprn", "/.", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"ab", "[", "x__", "]"}], "\[RuleDelayed]", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{
                RowBox[{"Length", "[", 
                 RowBox[{"{", "x", "}"}], "]"}], "\[Equal]", "2"}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#1", "]"}], "\[Equal]", "1"}], 
                    ",", 
                    RowBox[{
                    RowBox[{"Signature", "[", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", 
                    RowBox[{"Signature", "[", 
                    RowBox[{"{", "x", "}"}], "]"}], " ", 
                    RowBox[{"ab", "@@", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"Signature", "[", 
                    RowBox[{"{", "x", "}"}], "]"}], " ", 
                    RowBox[{"ab", "@@", 
                    RowBox[{"Sort", "[", 
                    RowBox[{"{", "x", "}"}], "]"}]}]}]}], "]"}], "&"}], ")"}],
                 "[", 
                RowBox[{"Select", "[", 
                 RowBox[{"consec", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{
                    RowBox[{"{", "x", "}"}], "\[Intersection]", "#1"}], "]"}],
                     "\[Equal]", "2"}], "&"}], ",", "1"}], "]"}], "]"}], ",", 
               RowBox[{
                RowBox[{"(", 
                 RowBox[{
                  RowBox[{"If", "[", 
                   RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "#1", "]"}], "\[Equal]", "1"}], 
                    ",", 
                    RowBox[{
                    RowBox[{"Signature", "[", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], " ", 
                    RowBox[{"Signature", "[", 
                    RowBox[{"{", "x", "}"}], "]"}], " ", 
                    RowBox[{"ab", "@@", 
                    RowBox[{"#1", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], ",", 
                    RowBox[{"Block", "[", 
                    RowBox[{
                    RowBox[{"{", 
                    RowBox[{
                    RowBox[{"xLikeLines", "=", 
                    RowBox[{"Select", "[", 
                    RowBox[{"consec", ",", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"#1", "\[Intersection]", 
                    RowBox[{"{", "x", "}"}]}], "]"}], "\[Equal]", "2"}], 
                    "&"}]}], "]"}]}], ",", "boundaries"}], "}"}], ",", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", "xLikeLines", "]"}], "\[Equal]", 
                    "0"}], ",", 
                    RowBox[{
                    RowBox[{"Signature", "[", 
                    RowBox[{"{", "x", "}"}], "]"}], " ", 
                    RowBox[{"ab", "@@", 
                    RowBox[{"Sort", "[", 
                    RowBox[{"{", "x", "}"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"boundaries", "=", 
                    RowBox[{"Complement", "[", 
                    RowBox[{
                    RowBox[{"{", "x", "}"}], ",", 
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], ";", 
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{
                    RowBox[{"boundaries", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "<", 
                    RowBox[{"boundaries", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}], ",", "nGuess", ",", 
                    "0"}], "]"}], "+", 
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}], "]"}], 
                    "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"boundaries", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "<", 
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", "nGuess", 
                    ",", "0"}], "]"}], "+", 
                    RowBox[{"boundaries", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}], "]"}]}], ">", 
                    RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{
                    RowBox[{"boundaries", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}], "<", 
                    RowBox[{"boundaries", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], ",", "nGuess", ",", 
                    "0"}], "]"}], "+", 
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "1"}], "]"}], "]"}]}]}], "]"}], "]"}], 
                    "+", 
                    RowBox[{"Length", "[", 
                    RowBox[{"Range", "[", 
                    RowBox[{
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}], ",", 
                    RowBox[{
                    RowBox[{"If", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"boundaries", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], "<", 
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", 
                    RowBox[{"1", ",", "2"}], "]"}], "]"}]}], ",", "nGuess", 
                    ",", "0"}], "]"}], "+", 
                    RowBox[{"boundaries", "[", 
                    RowBox[{"[", "2", "]"}], "]"}]}]}], "]"}], "]"}]}]}], ",", 
                    RowBox[{
                    RowBox[{"boundaries", "=", 
                    RowBox[{"Reverse", "[", "boundaries", "]"}]}], ";"}]}], 
                    "]"}], ";", 
                    RowBox[{
                    RowBox[{"-", 
                    RowBox[{"Signature", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{"boundaries", ",", 
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}], " ", 
                    RowBox[{"Signature", "[", 
                    RowBox[{"{", "x", "}"}], "]"}], " ", 
                    RowBox[{"ab", "@@", 
                    RowBox[{"RotateLeft", "[", 
                    RowBox[{"Join", "[", 
                    RowBox[{"boundaries", ",", 
                    RowBox[{"xLikeLines", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "]"}]}]}]}]}], 
                    "]"}]}], "]"}]}], "]"}], "&"}], ")"}], "[", 
                RowBox[{"Select", "[", 
                 RowBox[{"xLike", ",", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"Length", "[", 
                    RowBox[{"#1", "\[Intersection]", 
                    RowBox[{"{", "x", "}"}]}], "]"}], "\[Equal]", "4"}], 
                   "&"}]}], "]"}], "]"}]}], "]"}]}], "}"}]}]}]}], "]"}]}], 
      "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{"twistorSchouten", "=", 
     RowBox[{
      RowBox[{
       RowBox[{"#1", "//.", 
        RowBox[{"{", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"a___", ",", "x_", ",", "b___", ",", "y_", ",", "c___"}],
              "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"d___", ",", "x_", ",", "e___", ",", "y_", ",", "f___"}],
              "]"}]}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Signature", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", 
                RowBox[{"Sort", "[", 
                 RowBox[{"{", 
                  RowBox[{"a", ",", "b", ",", "c"}], "}"}], "]"}]}], "}"}], 
              "]"}], "]"}], " ", 
            RowBox[{"Signature", "[", 
             RowBox[{"{", 
              RowBox[{"a", ",", "x", ",", "b", ",", "y", ",", "c"}], "}"}], 
             "]"}], " ", 
            RowBox[{"Signature", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", 
                RowBox[{"Sort", "[", 
                 RowBox[{"{", 
                  RowBox[{"d", ",", "e", ",", "f"}], "}"}], "]"}]}], "}"}], 
              "]"}], "]"}], " ", 
            RowBox[{"Signature", "[", 
             RowBox[{"{", 
              RowBox[{"d", ",", "x", ",", "e", ",", "y", ",", "f"}], "}"}], 
             "]"}], " ", 
            RowBox[{"ab", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", 
                RowBox[{"Sort", "[", 
                 RowBox[{"{", 
                  RowBox[{"a", ",", "b", ",", "c"}], "}"}], "]"}]}], "}"}], 
              "]"}]}], " ", 
            RowBox[{"ab", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", 
                RowBox[{"Sort", "[", 
                 RowBox[{"{", 
                  RowBox[{"d", ",", "e", ",", "f"}], "}"}], "]"}]}], "}"}], 
              "]"}]}]}]}], ",", 
          RowBox[{
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"a___", ",", "x_", ",", "b___", ",", "y_", ",", "c___"}],
              "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"d___", ",", "y_", ",", "e___", ",", "x_", ",", "f___"}],
              "]"}]}], "\[RuleDelayed]", 
           RowBox[{
            RowBox[{"Signature", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", 
                RowBox[{"Sort", "[", 
                 RowBox[{"{", 
                  RowBox[{"a", ",", "b", ",", "c"}], "}"}], "]"}]}], "}"}], 
              "]"}], "]"}], " ", 
            RowBox[{"Signature", "[", 
             RowBox[{"{", 
              RowBox[{"a", ",", "x", ",", "b", ",", "y", ",", "c"}], "}"}], 
             "]"}], " ", 
            RowBox[{"Signature", "[", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", 
                RowBox[{"Sort", "[", 
                 RowBox[{"{", 
                  RowBox[{"d", ",", "e", ",", "f"}], "}"}], "]"}]}], "}"}], 
              "]"}], "]"}], " ", 
            RowBox[{"Signature", "[", 
             RowBox[{"{", 
              RowBox[{"d", ",", "y", ",", "e", ",", "x", ",", "f"}], "}"}], 
             "]"}], " ", 
            RowBox[{"ab", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", 
                RowBox[{"Sort", "[", 
                 RowBox[{"{", 
                  RowBox[{"a", ",", "b", ",", "c"}], "}"}], "]"}]}], "}"}], 
              "]"}]}], " ", 
            RowBox[{"ab", "@@", 
             RowBox[{"Flatten", "[", 
              RowBox[{"{", 
               RowBox[{"x", ",", "y", ",", 
                RowBox[{"Sort", "[", 
                 RowBox[{"{", 
                  RowBox[{"d", ",", "e", ",", "f"}], "}"}], "]"}]}], "}"}], 
              "]"}]}]}]}]}], "}"}]}], "//.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "b_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "c_", ",", "d_"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "d_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "c_", ",", "b_"}], "]"}]}]}], 
          "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "a", ",", "c"}], "]"}], " ", 
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "b", ",", "d"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "b_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "c_", ",", "d_"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "c_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "b_", ",", "d_"}], "]"}]}]}], 
          "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "a", ",", "d"}], "]"}], " ", 
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "c", ",", "b"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "b_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "c_", ",", "d_"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "d_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "b_", ",", "c_"}], "]"}]}]}], 
          "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "a", ",", "c"}], "]"}], " ", 
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "b", ",", "d"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "b_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "c_", ",", "d_"}], "]"}]}], "+", 
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "c_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "d_", ",", "b_"}], "]"}]}]}], 
          "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "a", ",", "d"}], "]"}], " ", 
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "c", ",", "b"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"ab", "[", 
              RowBox[{"x_", ",", "y_", ",", "a_", ",", "b_"}], "]"}]}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "c_", ",", "d_"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "d_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "b_", ",", "c_"}], "]"}]}]}], 
          "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"ab", "[", 
             RowBox[{"x", ",", "y", ",", "a", ",", "c"}], "]"}]}], " ", 
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "b", ",", "d"}], "]"}]}]}], ",", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{"-", 
             RowBox[{"ab", "[", 
              RowBox[{"x_", ",", "y_", ",", "a_", ",", "b_"}], "]"}]}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "c_", ",", "d_"}], "]"}]}], "-", 
           RowBox[{
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "a_", ",", "c_"}], "]"}], " ", 
            RowBox[{"ab", "[", 
             RowBox[{"x_", ",", "y_", ",", "d_", ",", "b_"}], "]"}]}]}], 
          "\[RuleDelayed]", 
          RowBox[{
           RowBox[{"-", 
            RowBox[{"ab", "[", 
             RowBox[{"x", ",", "y", ",", "a", ",", "d"}], "]"}]}], " ", 
           RowBox[{"ab", "[", 
            RowBox[{"x", ",", "y", ",", "c", ",", "b"}], "]"}]}]}]}], "}"}]}],
       "&"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"twistorSimplify", "[", 
      RowBox[{"exprn_", ",", 
       RowBox[{"orderQ_", ":", "0"}]}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Count", "[", 
         RowBox[{"exprn", ",", 
          RowBox[{"ab", "[", 
           RowBox[{"x_", ",", "y_"}], "]"}], ",", "\[Infinity]"}], "]"}], ">",
         "0"}], ",", 
       RowBox[{"Simplify", "[", 
        RowBox[{
         RowBox[{"order", "[", "exprn", "]"}], "/.", 
         RowBox[{"Apply", "[", 
          RowBox[{"Rule", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{
              RowBox[{"{", 
               RowBox[{"#1", ",", 
                RowBox[{"twistorSchouten", "[", "#1", "]"}]}], "}"}], "&"}], 
             ")"}], "/@", 
            RowBox[{"Cases", "[", 
             RowBox[{"exprn", ",", 
              RowBox[{
               RowBox[{
                RowBox[{
                 RowBox[{"ab", "[", "x__", "]"}], " ", 
                 RowBox[{"ab", "[", "y__", "]"}]}], "-", 
                RowBox[{
                 RowBox[{"ab", "[", "z__", "]"}], " ", 
                 RowBox[{"ab", "[", "w__", "]"}]}]}], "|", 
               RowBox[{
                RowBox[{
                 RowBox[{"ab", "[", "x__", "]"}], " ", 
                 RowBox[{"ab", "[", "y__", "]"}]}], "+", 
                RowBox[{
                 RowBox[{"ab", "[", "z__", "]"}], " ", 
                 RowBox[{"ab", "[", "w__", "]"}]}]}]}], ",", 
              RowBox[{"{", 
               RowBox[{"0", ",", "\[Infinity]"}], "}"}]}], "]"}]}], ",", 
           RowBox[{"{", "1", "}"}]}], "]"}]}], "]"}], ",", 
       RowBox[{"order", "[", 
        RowBox[{
         RowBox[{"FullSimplify", "[", 
          RowBox[{
           RowBox[{"If", "[", 
            RowBox[{
             RowBox[{"orderQ", "\[Equal]", "1"}], ",", 
             RowBox[{"order", "[", 
              RowBox[{
               RowBox[{"FullSimplify", "[", 
                RowBox[{
                 RowBox[{"order", "[", 
                  RowBox[{"exprn", ",", "0"}], "]"}], ",", 
                 RowBox[{"TransformationFunctions", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"Automatic", ",", "twistorSchouten"}], "}"}]}]}], 
                "]"}], ",", "1"}], "]"}], ",", "exprn"}], "]"}], ",", 
           RowBox[{"TransformationFunctions", "\[Rule]", 
            RowBox[{"{", 
             RowBox[{"Automatic", ",", "twistorSchouten"}], "}"}]}]}], "]"}], 
         ",", "1"}], "]"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"randomPositiveZs", "[", "20", "]"}], ";"}], "\n", "\n", 
   RowBox[{
    RowBox[{"partdlog", "[", "x_", "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"dlogs", "=", 
        RowBox[{"Union", "[", 
         RowBox[{"Flatten", "@", 
          RowBox[{"Cases", "[", 
           RowBox[{"x", ",", "_dlog", ",", "Infinity"}], "]"}]}], "]"}]}], 
       "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"Coefficient", "[", 
           RowBox[{"x", ",", "#"}], "]"}]}], "}"}], "&"}], "/@", "dlogs"}]}], 
     "]"}]}], "\n", 
   RowBox[{
    RowBox[{"partQlogR", "[", 
     RowBox[{
      RowBox[{"a_", "+", "b_"}], ",", "c_"}], "]"}], ":=", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"partQlogR", "[", 
       RowBox[{"a", ",", "c"}], "]"}], ",", 
      RowBox[{"partQlogR", "[", 
       RowBox[{"b", ",", "c"}], "]"}]}], "}"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"partQlogR", "[", 
     RowBox[{
      RowBox[{"b_", " ", "a_"}], ",", "c_"}], "]"}], ":=", " ", 
    RowBox[{
     RowBox[{"partQlogR", "[", 
      RowBox[{"a", ",", 
       RowBox[{"b", " ", "c"}]}], "]"}], "/;", 
     RowBox[{
      RowBox[{"FreeQ", "[", 
       RowBox[{"b", ",", "R"}], "]"}], "&&", 
      RowBox[{"FreeQ", "[", 
       RowBox[{"b", ",", "Qlog"}], "]"}]}]}]}], "\n", "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"monic", "[", "preexp_", "]"}], ":=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"exp", "=", 
         RowBox[{"Together", "[", "preexp", "]"}]}], "}"}], ",", 
       RowBox[{"With", "[", 
        RowBox[{
         RowBox[{"{", 
          RowBox[{
           RowBox[{"d1", "=", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{"Numerator", "[", "exp", "]"}], ",", "\[Tau]"}], 
             "]"}]}], ",", 
           RowBox[{"d2", "=", 
            RowBox[{"D", "[", 
             RowBox[{
              RowBox[{"Denominator", "[", "exp", "]"}], ",", "\[Tau]"}], 
             "]"}]}]}], "}"}], ",", 
         RowBox[{"Which", "[", 
          RowBox[{
           RowBox[{"d1", "===", "0"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"1", "/", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"\[Tau]", "+", 
                  RowBox[{"Simplify", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Denominator", "[", "exp", "]"}], "/.", 
                    RowBox[{"\[Tau]", "->", "0"}]}], ")"}], "/", "d2"}], 
                   "]"}]}], "/.", "tocaps"}], "/.", "sortab"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Simplify", "[", 
                RowBox[{
                 RowBox[{"Numerator", "[", "exp", "]"}], "/", "d2"}], "]"}], "/.",
                "tocaps"}], "/.", "sortab"}]}], "}"}], ",", 
           RowBox[{"d2", "===", "0"}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"(", 
              RowBox[{
               RowBox[{
                RowBox[{"\[Tau]", "+", 
                 RowBox[{"Simplify", "[", 
                  RowBox[{
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Numerator", "[", "exp", "]"}], "/.", 
                    RowBox[{"\[Tau]", "->", "0"}]}], ")"}], "/", "d1"}], 
                  "]"}]}], "/.", "tocaps"}], "/.", "sortab"}], ")"}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Simplify", "[", 
                RowBox[{"d1", "/", 
                 RowBox[{"Denominator", "[", "exp", "]"}]}], "]"}], "/.", 
               "tocaps"}], "/.", "sortab"}]}], "}"}], ",", 
           RowBox[{
            RowBox[{"d1", "=!=", "0"}], "&&", 
            RowBox[{"d2", "=!=", "0"}]}], ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"\[Tau]", "+", 
                  RowBox[{"Simplify", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Numerator", "[", "exp", "]"}], "/.", 
                    RowBox[{"\[Tau]", "->", "0"}]}], ")"}], "/", "d1"}], 
                   "]"}]}], "/.", "tocaps"}], "/.", "sortab"}], ")"}], "/", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{
                 RowBox[{"\[Tau]", "+", 
                  RowBox[{"Simplify", "[", 
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{"Denominator", "[", "exp", "]"}], "/.", 
                    RowBox[{"\[Tau]", "->", "0"}]}], ")"}], "/", "d2"}], 
                   "]"}]}], "/.", "tocaps"}], "/.", "sortab"}], ")"}]}], ",", 
             RowBox[{
              RowBox[{
               RowBox[{"Simplify", "[", 
                RowBox[{"d1", "/", "d2"}], "]"}], "/.", "tocaps"}], "/.", 
              "sortab"}]}], "}"}]}], "]"}]}], "]"}]}], "]"}]}], ";"}], "\n", 
   RowBox[{
    RowBox[{
     RowBox[{"logmonic", "[", "exp_", "]"}], ":=", 
     RowBox[{"With", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"hh", "=", 
         RowBox[{"monic", "[", "exp", "]"}]}], "}"}], ",", 
       RowBox[{"Total", "[", 
        RowBox[{"log", "/@", "hh"}], "]"}]}], "]"}]}], ";"}]}]}]], "Code",
 InitializationCell->True,
 CellChangeTimes->{{3.776488851245846*^9, 3.77648886368972*^9}, {
   3.7764889192535944`*^9, 3.776488951831362*^9}, {3.776488987419117*^9, 
   3.77648898781295*^9}, {3.776490093961666*^9, 3.7764901350600767`*^9}, {
   3.7765001321327257`*^9, 3.7765001330341563`*^9}, {3.776500845101471*^9, 
   3.776500845658559*^9}, {3.7765018811363077`*^9, 3.7765019449865456`*^9}, {
   3.7765644298053026`*^9, 3.7765644373656826`*^9}, {3.77656455180823*^9, 
   3.776564596096243*^9}, 3.776564636690528*^9, {3.7766599308663588`*^9, 
   3.776659931085044*^9}, {3.7789943590857706`*^9, 3.778994388570044*^9}, {
   3.7790139444296827`*^9, 3.7790139452108784`*^9}, {3.8048510797234993`*^9, 
   3.804851080146533*^9}, 
   3.8048517751387997`*^9},ExpressionUUID->"c366fc84-ca3b-4de0-96ee-\
a68c69272ca4"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", "peiping", " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"degree", "[", 
     RowBox[{"x_", ",", "y_"}], "]"}], ":=", 
    RowBox[{"Coefficient", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["$x", "#"], "&"}], "/@", "x"}], "]"}], "-", 
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["$x", "#"], "&"}], "/@", "y"}], "]"}]}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        SubscriptBox["$x", "i"], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"degree", "[", "x_", "]"}], ":=", 
    RowBox[{"Coefficient", "[", 
     RowBox[{
      RowBox[{"Total", "[", 
       RowBox[{
        RowBox[{
         SubscriptBox["$x", "#"], "&"}], "/@", "x"}], "]"}], ",", 
      RowBox[{"Table", "[", 
       RowBox[{
        SubscriptBox["$x", "i"], ",", 
        RowBox[{"{", 
         RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"degree", "[", 
      RowBox[{"ab", "[", "x__", "]"}], "]"}], ":=", 
     RowBox[{"Coefficient", "[", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["$x", "#"], "&"}], "/@", 
         RowBox[{"{", "x", "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         SubscriptBox["$x", "i"], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"degree", "[", 
      RowBox[{"R", "[", "x__", "]"}], "]"}], ":=", 
     RowBox[{"Coefficient", "[", 
      RowBox[{
       RowBox[{"Total", "[", 
        RowBox[{
         RowBox[{
          SubscriptBox["$x", "#"], "&"}], "/@", 
         RowBox[{"{", "x", "}"}]}], "]"}], ",", 
       RowBox[{"Table", "[", 
        RowBox[{
         SubscriptBox["$x", "i"], ",", 
         RowBox[{"{", 
          RowBox[{"i", ",", "n"}], "}"}]}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"degree", "[", 
      RowBox[{"x_", " ", "y_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"degree", "[", "x", "]"}], "+", 
      RowBox[{"degree", "[", "y", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"degree", "[", 
      RowBox[{"x_", " ", "+", "y_"}], "]"}], ":=", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"degree", "[", "x", "]"}], "===", 
        RowBox[{"degree", "[", "y", "]"}]}], ",", 
       RowBox[{"degree", "[", "x", "]"}], ",", 
       RowBox[{
        RowBox[{"Print", "[", "\"\<degree error\>\"", "]"}], ";"}]}], "]"}]}],
     ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"degree", "[", 
      RowBox[{"x_", "/", "y_"}], "]"}], ":=", 
     RowBox[{
      RowBox[{"degree", "[", "x", "]"}], "-", 
      RowBox[{"degree", "[", "y", "]"}]}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"incom", "[", 
     RowBox[{"x_", ",", "y_", ",", "z_"}], "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"hh", "=", 
        RowBox[{"degree", "[", 
         RowBox[{"x", ",", "y"}], "]"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Inner", "[", 
         RowBox[{"Times", ",", 
          RowBox[{"hh", "[", 
           RowBox[{"[", "#", "]"}], "]"}], ",", "#", ",", "List"}], "]"}], 
        "&"}], "@", 
       RowBox[{"(", 
        RowBox[{"First", "/@", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", "hh", "]"}], "-", 
            RowBox[{"degree", "[", "z", "]"}]}], ",", "1"}], "]"}]}], 
        ")"}]}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"incom", "[", 
     RowBox[{"x_", ",", "z_"}], "]"}], ":=", 
    RowBox[{"With", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"hh", "=", 
        RowBox[{"degree", "[", "x", "]"}]}], "}"}], ",", 
      RowBox[{
       RowBox[{
        RowBox[{"Inner", "[", 
         RowBox[{"Times", ",", 
          RowBox[{"hh", "[", 
           RowBox[{"[", "#", "]"}], "]"}], ",", "#", ",", "List"}], "]"}], 
        "&"}], "@", 
       RowBox[{"(", 
        RowBox[{"First", "/@", 
         RowBox[{"Position", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"Abs", "[", "hh", "]"}], "-", 
            RowBox[{"degree", "[", "z", "]"}]}], ",", "1"}], "]"}]}], 
        ")"}]}]}], "]"}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"incom", "[", 
     RowBox[{"x_Qlog", " ", "y_R"}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"FreeQ", "[", 
       RowBox[{"x", ",", "cap"}], "]"}], ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"FreeQ", "[", 
         RowBox[{"y", ",", "cap"}], "]"}], ",", 
        RowBox[{"incom", "[", 
         RowBox[{
          RowBox[{"x", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", "y"}], "]"}], ",", 
        RowBox[{"-", "1"}]}], "]"}], ",", "1"}], "]"}], 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"1", " ", ":", " ", "Qlogwithcap"}], ",", " ", 
      RowBox[{
       RowBox[{"-", "1"}], ":", " ", "Rwithcap"}]}], "*)"}]}]}]}]], "Code",
 CellChangeTimes->{{3.800104822325776*^9, 3.8001048290654807`*^9}, 
   3.8001048639955344`*^9, {3.8001107642626333`*^9, 3.8001107812129135`*^9}, {
   3.800111020396446*^9, 3.800111020601639*^9}, {3.804851143614091*^9, 
   3.8048511478379745`*^9}},ExpressionUUID->"838cf258-cadd-4a1e-a8d1-\
8b5c3b683cd1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"integrate", " ", "symbol"}], ",", " ", 
    RowBox[{"debug", " ", "mode"}]}], " ", "*)"}], "\n", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"if", " ", "the", " ", "integral", " ", "is", " ", "finite"}], 
    ",", " ", 
    RowBox[{
    "all", " ", "ctensors", " ", "with", " ", "0", " ", "will", " ", "cancel",
      " ", "with", " ", "each", " ", "other"}]}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{"Clear", "[", 
    RowBox[{"cint", ",", "ctensor"}], "]"}], "\[IndentingNewLine]", 
   RowBox[{"(*", 
    RowBox[{
     RowBox[{"ctensor", "[", 
      RowBox[{"___", ",", 
       RowBox[{"1", "|", 
        RowBox[{"-", "1"}]}], ",", "___"}], "]"}], ":=", "0"}], "*)"}], "\n", 
   RowBox[{
    RowBox[{"ctensor", "[", 
     RowBox[{"x___", ",", 
      RowBox[{
       RowBox[{"b_.", " ", 
        RowBox[{"ctensor", "[", "a__", "]"}]}], "+", "c_."}], ",", "y___"}], 
     "]"}], ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"c", "===", "0"}], ",", 
        RowBox[{"b", " ", 
         RowBox[{"ctensor", "[", 
          RowBox[{"x", ",", "a", ",", "y"}], "]"}]}], ",", 
        RowBox[{
         RowBox[{"b", " ", 
          RowBox[{"ctensor", "[", 
           RowBox[{"x", ",", "a", ",", "y"}], "]"}]}], "+", 
         RowBox[{"ctensor", "[", 
          RowBox[{"x", ",", "c", ",", "y"}], "]"}]}]}], "]"}], ")"}], "/;", 
     RowBox[{"IntegerQ", "[", "b", "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"cint", "[", 
     RowBox[{"a_", "+", "b_"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"cint", "[", "a", "]"}], "+", 
     RowBox[{"cint", "[", "b", "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"cint", "[", 
     RowBox[{"b_cinteger", " ", 
      RowBox[{"ctensor", "[", "c_", "]"}]}], "]"}], ":=", 
    RowBox[{"b", " ", 
     RowBox[{"cint", "[", 
      RowBox[{"ctensor", "[", "c", "]"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"cint", "[", 
     RowBox[{
      RowBox[{"ctensor", "[", 
       RowBox[{"a__", ",", 
        RowBox[{"\[Tau]", "+", "b_."}]}], "]"}], " ", 
      RowBox[{"dlog", "[", 
       RowBox[{"\[Tau]", "+", "c_."}], "]"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"(", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"ctensor", "[", 
         RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "/.", 
       RowBox[{"{", 
        RowBox[{"\[Tau]", "->", "0"}], "}"}]}], ")"}], "+", 
     RowBox[{"ctensor", "[", 
      RowBox[{
       RowBox[{"cint", "[", 
        RowBox[{"Expand", "[", 
         RowBox[{
          RowBox[{"ctensor", "[", "a", "]"}], " ", 
          RowBox[{"dlog", "[", 
           RowBox[{"\[Tau]", "+", "c"}], "]"}]}], "]"}], "]"}], ",", 
       RowBox[{"b", "-", "c"}]}], "]"}], "-", 
     RowBox[{"ctensor", "[", 
      RowBox[{
       RowBox[{"cint", "[", 
        RowBox[{"Expand", "[", 
         RowBox[{
          RowBox[{"ctensor", "[", "a", "]"}], " ", 
          RowBox[{"dlog", "[", 
           RowBox[{"\[Tau]", "+", "b"}], "]"}]}], "]"}], "]"}], ",", 
       RowBox[{"b", "-", "c"}]}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"cint", "[", 
     RowBox[{
      RowBox[{"ctensor", "[", 
       RowBox[{"a__", ",", "b_"}], "]"}], " ", 
      RowBox[{"dlog", "[", 
       RowBox[{"\[Tau]", "+", "c_."}], "]"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"-", 
         RowBox[{"ctensor", "[", 
          RowBox[{"a", ",", "b", ",", "c"}], "]"}]}], "/.", 
        RowBox[{"{", 
         RowBox[{"\[Tau]", "->", "0"}], "}"}]}], ")"}], "+", 
      RowBox[{"ctensor", "[", 
       RowBox[{
        RowBox[{"cint", "[", 
         RowBox[{"Expand", "[", 
          RowBox[{
           RowBox[{"ctensor", "[", "a", "]"}], " ", 
           RowBox[{"dlog", "[", 
            RowBox[{"\[Tau]", "+", "c"}], "]"}]}], "]"}], "]"}], ",", "b"}], 
       "]"}]}], "/;", 
     RowBox[{"FreeQ", "[", 
      RowBox[{"b", ",", "\[Tau]"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"cint", "[", 
     RowBox[{
      RowBox[{"ctensor", "[", 
       RowBox[{"\[Tau]", "+", "b_."}], "]"}], " ", 
      RowBox[{"dlog", "[", 
       RowBox[{"\[Tau]", "+", "a_"}], "]"}]}], "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"b", "===", "0"}], ",", 
      RowBox[{"-", 
       RowBox[{"ctensor", "[", 
        RowBox[{"a", ",", "a"}], "]"}]}], ",", 
      RowBox[{
       RowBox[{"-", 
        RowBox[{"ctensor", "[", 
         RowBox[{"b", ",", "a"}], "]"}]}], "-", 
       RowBox[{"ctensor", "[", 
        RowBox[{
         RowBox[{"a", "/", "b"}], ",", 
         RowBox[{"b", "-", "a"}]}], "]"}]}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"cint", "[", 
     RowBox[{
      RowBox[{"ctensor", "[", 
       RowBox[{"\[Tau]", "+", "b_"}], "]"}], " ", 
      RowBox[{"dlog", "[", "\[Tau]", "]"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{"-", 
      RowBox[{"ctensor", "[", 
       RowBox[{"b", ",", "0"}], "]"}]}], "-", 
     RowBox[{"ctensor", "[", 
      RowBox[{"0", ",", "b"}], "]"}], "+", 
     RowBox[{"ctensor", "[", 
      RowBox[{"b", ",", "b"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"cint", "[", 
     RowBox[{
      RowBox[{"ctensor", "[", "\[Tau]", "]"}], " ", 
      RowBox[{"dlog", "[", "\[Tau]", "]"}]}], "]"}], ":=", 
    RowBox[{"-", 
     RowBox[{"ctensor", "[", 
      RowBox[{"0", ",", "0"}], "]"}]}]}], "\n", 
   RowBox[{
    RowBox[{"cint", "[", 
     RowBox[{
      RowBox[{"ctensor", "[", "b_.", "]"}], " ", 
      RowBox[{"dlog", "[", 
       RowBox[{"\[Tau]", "+", "c_."}], "]"}]}], "]"}], ":=", 
    RowBox[{
     RowBox[{
      RowBox[{"-", 
       RowBox[{"ctensor", "[", 
        RowBox[{"b", ",", "c"}], "]"}]}], "-", 
      RowBox[{"ctensor", "[", 
       RowBox[{"c", ",", "b"}], "]"}]}], "/;", 
     RowBox[{"FreeQ", "[", 
      RowBox[{"b", ",", "\[Tau]"}], "]"}]}]}]}]}]], "Code",
 CellChangeTimes->{{3.804575744637427*^9, 3.8045759293088617`*^9}, {
   3.804576187397438*^9, 3.804576256340947*^9}, {3.8045763153636503`*^9, 
   3.804576337113505*^9}, {3.8045763984362645`*^9, 3.8045764618314204`*^9}, {
   3.8045765227570915`*^9, 3.8045765265375776`*^9}, {3.804576561282981*^9, 
   3.8045766002614365`*^9}, {3.8045766377038784`*^9, 
   3.8045766488221226`*^9}, {3.8045766833274393`*^9, 
   3.8045766952744884`*^9}, {3.8045770328486795`*^9, 3.804577032998153*^9}, {
   3.804577081404724*^9, 3.804577082105414*^9}, {3.8045771842801075`*^9, 
   3.8045772010477457`*^9}, {3.8045772512778454`*^9, 3.80457736056089*^9}, {
   3.804837592532903*^9, 3.804837595238964*^9}, {3.8048376933660927`*^9, 
   3.8048377087835197`*^9}, {3.804837774593884*^9, 3.804837923474412*^9}, {
   3.8048379604929857`*^9, 3.8048379663287306`*^9}, {3.8048380310835533`*^9, 
   3.8048381162468157`*^9}, {3.8048383114291625`*^9, 3.8048383225538597`*^9}, 
   3.8048383569679036`*^9, {3.8048385208106804`*^9, 3.8048385227476625`*^9}, 
   3.804838564457723*^9, {3.8048409431941624`*^9, 3.8048409622499094`*^9}, {
   3.804842916797185*^9, 3.804842975870989*^9}, {3.804849357638858*^9, 
   3.804849369709858*^9}, 3.8048494118708763`*^9, {3.8048496670696487`*^9, 
   3.80484968377884*^9}, {3.804849874964019*^9, 3.804849904113927*^9}, {
   3.804851016635345*^9, 3.8048510244228754`*^9}, {3.804851065449102*^9, 
   3.8048510734105196`*^9}, {3.8048511540195475`*^9, 
   3.8048511613231015`*^9}},ExpressionUUID->"f3f4a160-dda7-4e3a-b99a-\
400307eef730"],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{"some", " ", "symbol", " ", "calculation"}], " ", "*)"}], "\n", 
  RowBox[{
   RowBox[{
    RowBox[{"tensor", "[", 
     RowBox[{"x___", ",", 
      RowBox[{"y_", " ", "z_"}], ",", "w___"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"tensor", "[", 
      RowBox[{"x", ",", "y", ",", "w"}], "]"}], "+", 
     RowBox[{"tensor", "[", 
      RowBox[{"x", ",", "z", ",", "w"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tensor", "[", 
     RowBox[{"x___", ",", 
      RowBox[{"y_", " ", "/", "z_"}], ",", "w___"}], "]"}], ":=", 
    RowBox[{
     RowBox[{"tensor", "[", 
      RowBox[{"x", ",", "y", ",", "w"}], "]"}], "-", 
     RowBox[{"tensor", "[", 
      RowBox[{"x", ",", "z", ",", "w"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tensor", "[", 
     RowBox[{"x___", ",", 
      RowBox[{"1", "/", "y_"}], ",", "w___"}], "]"}], ":=", 
    RowBox[{"-", 
     RowBox[{"tensor", "[", 
      RowBox[{"x", ",", "y", ",", "w"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tensor", "[", 
     RowBox[{"x___", ",", 
      RowBox[{"y_", "^", "a_Integer"}], ",", "w___"}], "]"}], ":=", 
    RowBox[{"a", " ", 
     RowBox[{"tensor", "[", 
      RowBox[{"x", ",", "y", ",", "w"}], "]"}]}]}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"tensor", "[", 
     RowBox[{"___", ",", 
      RowBox[{"1", "|", 
       RowBox[{"-", "1"}]}], ",", "___"}], "]"}], ":=", "0"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"expandTensor", "[", "exp_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Expand", "[", 
      RowBox[{
       RowBox[{"exp", "/.", 
        RowBox[{"Tensor", "\[Rule]", "tensor"}]}], ",", "_tensor"}], "]"}], "/.", 
     RowBox[{"tensor", "\[Rule]", "Tensor"}]}]}], "\n", 
   RowBox[{
    RowBox[{"ExpandTensor", "[", "exp_", "]"}], ":=", 
    RowBox[{"expandTensor", "[", 
     RowBox[{"exp", "/.", 
      RowBox[{
       RowBox[{"Tensor", "[", "x__", "]"}], "\[RuleDelayed]", 
       RowBox[{"Tensor", "@@", 
        RowBox[{"(", 
         RowBox[{"Factor", "/@", 
          RowBox[{"{", "x", "}"}]}], ")"}]}]}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"Shuffle", "[", 
     RowBox[{"s1_", ",", "s2_"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", 
       RowBox[{"p", ",", "tp", ",", "ord"}], "}"}], ",", 
      RowBox[{
       RowBox[{"p", "=", 
        RowBox[{
         RowBox[{"Permutations", "@", 
          RowBox[{"Join", "[", 
           RowBox[{
            RowBox[{
             RowBox[{"1", "&"}], "/@", "s1"}], ",", 
            RowBox[{
             RowBox[{"0", "&"}], "/@", "s2"}]}], "]"}]}], "\[Transpose]"}]}], 
       ";", 
       RowBox[{"tp", "=", 
        RowBox[{"BitXor", "[", 
         RowBox[{"p", ",", "1"}], "]"}]}], ";", 
       RowBox[{"ord", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Accumulate", "[", "p", "]"}], " ", "p"}], "+", 
         RowBox[{
          RowBox[{"(", 
           RowBox[{
            RowBox[{"Accumulate", "[", "tp", "]"}], "+", 
            RowBox[{"Length", "[", "s1", "]"}]}], ")"}], " ", "tp"}]}]}], ";", 
       RowBox[{
        RowBox[{
         RowBox[{"Outer", "[", 
          RowBox[{"Part", ",", 
           RowBox[{"{", 
            RowBox[{"Join", "[", 
             RowBox[{"s1", ",", "s2"}], "]"}], "}"}], ",", "ord", ",", "1"}], 
          "]"}], "[", 
         RowBox[{"[", "1", "]"}], "]"}], "\[Transpose]"}]}]}], "]"}]}], "\n", 
   RowBox[{
    RowBox[{"GetAlphabet", "[", "x_", "]"}], ":=", 
    RowBox[{
     RowBox[{"Cases", "[", 
      RowBox[{"x", ",", 
       RowBox[{
        RowBox[{"Tensor", "[", "y__", "]"}], "\[RuleDelayed]", "y"}], ",", 
       "Infinity"}], "]"}], "//", "Union"}]}], "\n", 
   RowBox[{
    RowBox[{"isRationalSymbolzero", "[", "$x_", "]"}], ":=", 
    RowBox[{"If", "[", 
     RowBox[{
      RowBox[{"$x", "===", "0"}], ",", "True", ",", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"!", 
         RowBox[{"(", 
          RowBox[{
           RowBox[{"Chop", "[", 
            RowBox[{"$x", "/.", 
             RowBox[{
              RowBox[{"Tensor", "[", "y__", "]"}], ":>", 
              RowBox[{"N", "[", 
               RowBox[{
                RowBox[{"Times", "@@", 
                 RowBox[{"(", 
                  RowBox[{"Log", "/@", 
                   RowBox[{"Abs", "/@", 
                    RowBox[{"{", "y", "}"}]}]}], ")"}]}], ",", "100"}], 
               "]"}]}]}], "]"}], "===", "0"}], ")"}]}], ",", "False", ",", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{
            RowBox[{"weights", "=", 
             RowBox[{"Length", "/@", 
              RowBox[{"(", 
               RowBox[{
                RowBox[{"Cases", "[", 
                 RowBox[{
                  RowBox[{"1", "+", "$x"}], ",", "_Tensor", ",", "Infinity"}],
                  "]"}], "//", "Union"}], ")"}]}]}], ",", 
            RowBox[{"x", "=", 
             RowBox[{
              RowBox[{"$x", "/.", 
               RowBox[{
                RowBox[{"Tensor", "[", 
                 RowBox[{"___", ",", 
                  RowBox[{"1", "|", 
                   RowBox[{"-", "1"}]}], ",", "___"}], "]"}], 
                "\[RuleDelayed]", "0"}]}], "/.", 
              RowBox[{
               RowBox[{"Tensor", "[", "y__", "]"}], ":>", 
               RowBox[{"Tensor", "@@", 
                RowBox[{"(", 
                 RowBox[{"Abs", "/@", 
                  RowBox[{"{", "y", "}"}]}], ")"}]}]}]}]}]}], "}"}], ",", 
          RowBox[{"If", "[", 
           RowBox[{
            RowBox[{"SameQ", "@@", "weights"}], ",", 
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{
               RowBox[{"weights", "[", 
                RowBox[{"[", "1", "]"}], "]"}], "===", "1"}], ",", 
              RowBox[{
               RowBox[{"Chop", "[", 
                RowBox[{
                 RowBox[{
                  RowBox[{"N", "[", 
                   RowBox[{"#", ",", "50"}], "]"}], "&"}], "/@", 
                 RowBox[{"(", 
                  RowBox[{"x", "/.", 
                   RowBox[{
                    RowBox[{"Tensor", "[", "x_", "]"}], ":>", 
                    RowBox[{"Log", "[", 
                    RowBox[{"Abs", "[", "x", "]"}], "]"}]}]}], ")"}]}], "]"}],
                "===", "0"}], ",", 
              RowBox[{"Module", "[", 
               RowBox[{
                RowBox[{"{", 
                 RowBox[{"HH", ",", "hh", ",", "basis", ",", "coeffs"}], 
                 "}"}], ",", 
                RowBox[{
                 RowBox[{"hh", "=", 
                  RowBox[{"Expand", "[", 
                   RowBox[{
                    RowBox[{"x", "/.", 
                    RowBox[{
                    RowBox[{"Tensor", "[", 
                    RowBox[{"y_", ",", "z__"}], "]"}], "\[RuleDelayed]", 
                    RowBox[{"Sum", "[", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"aaa", "[", 
                    RowBox[{"[", "2", "]"}], "]"}], 
                    RowBox[{"HH", "[", 
                    RowBox[{"aaa", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], "]"}], 
                    RowBox[{"Tensor", "[", "z", "]"}]}], ",", 
                    RowBox[{"{", 
                    RowBox[{"aaa", ",", 
                    RowBox[{"FactorInteger", "[", "y", "]"}]}], "}"}]}], 
                    "]"}]}]}], ",", 
                    RowBox[{"_Tensor", "|", "_HH"}]}], "]"}]}], ";", 
                 RowBox[{"basis", "=", 
                  RowBox[{
                   RowBox[{"Cases", "[", 
                    RowBox[{"hh", ",", "_HH", ",", "Infinity"}], "]"}], "//", 
                   "Union"}]}], ";", 
                 RowBox[{"coeffs", "=", 
                  RowBox[{"Last", "@", 
                   RowBox[{"CoefficientArrays", "[", 
                    RowBox[{"hh", ",", "basis"}], "]"}]}]}], ";", 
                 RowBox[{"AllTrue", "[", 
                  RowBox[{"coeffs", ",", "isRationalSymbolzero"}], "]"}]}]}], 
               "]"}]}], "]"}]}], "]"}]}], "]"}]}], "]"}]}], 
     "]"}]}]}]}]], "Code",
 CellChangeTimes->{{3.804851165468174*^9, 
  3.8048511757643657`*^9}},ExpressionUUID->"70e1b683-2e8b-49b0-ab4b-\
deb62c9c17de"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"(*", " ", 
   RowBox[{"make", " ", "Qbar", " ", "DCI"}], " ", "*)"}], 
  "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"allpeiping", "=", 
      RowBox[{
       RowBox[{"allpeiping0", "/.", 
        RowBox[{
         RowBox[{"a_", " ", 
          RowBox[{"Qlog", "[", "b_", "]"}], 
          RowBox[{"R", "[", "c__", "]"}]}], "\[RuleDelayed]", 
         RowBox[{"With", "[", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"hh", "=", 
             RowBox[{"degree", "[", 
              RowBox[{
               RowBox[{"b", "/.", "capexpand"}], "/.", "cap1exp"}], "]"}]}], 
            "}"}], ",", 
           RowBox[{"With", "[", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"kk", "=", 
               RowBox[{"Flatten", "[", 
                RowBox[{"{", 
                 RowBox[{
                  RowBox[{"Position", "[", 
                   RowBox[{"hh", ",", 
                    RowBox[{"-", "1"}]}], "]"}], ",", 
                  RowBox[{"Position", "[", 
                   RowBox[{"hh", ",", "1"}], "]"}]}], "}"}], "]"}]}], "}"}], 
             ",", 
             RowBox[{"If", "[", 
              RowBox[{
               RowBox[{"kk", "===", 
                RowBox[{"{", "}"}]}], ",", 
               RowBox[{"a", " ", 
                RowBox[{"Qlog", "[", "b", "]"}], 
                RowBox[{"R", "[", "c", "]"}]}], ",", 
               RowBox[{"a", " ", 
                RowBox[{"Qlog", "[", 
                 RowBox[{"b", " ", 
                  RowBox[{
                   RowBox[{"ab", "[", 
                    RowBox[{
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"Complement", "[", 
                    RowBox[{
                    RowBox[{"{", "c", "}"}], ",", "kk"}], "]"}]}], ",", 
                    RowBox[{"First", "[", "kk", "]"}]}], "]"}], "/", " ", 
                   RowBox[{"ab", "[", 
                    RowBox[{
                    RowBox[{"Sequence", "@@", 
                    RowBox[{"Complement", "[", 
                    RowBox[{
                    RowBox[{"{", "c", "}"}], ",", "kk"}], "]"}]}], ",", 
                    RowBox[{"Last", "[", "kk", "]"}]}], "]"}]}]}], "]"}], 
                RowBox[{"R", "[", "c", "]"}]}]}], "]"}]}], "]"}]}], "]"}]}]}],
        "/.", 
       RowBox[{"{", 
        RowBox[{
         RowBox[{
          RowBox[{"Qlog", "[", "1", "]"}], "\[RuleDelayed]", "0"}], ",", 
         RowBox[{
          RowBox[{"Qlog", "[", 
           RowBox[{"-", "1"}], "]"}], "\[RuleDelayed]", "0"}]}], "}"}]}]}], 
     ";"}], "//", "AbsoluteTiming"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{
     RowBox[{"allpeiping", "=", 
      RowBox[{"ParallelMap", "[", 
       RowBox[{
        RowBox[{
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{
              RowBox[{
               RowBox[{
                RowBox[{"#", "/.", "capexpand"}], "/.", "sortab"}], "/.", 
               "tocaps"}], "/.", "sortcap1"}], "/.", 
             RowBox[{
              RowBox[{"cap", "[", 
               RowBox[{"a_", ",", "b_"}], "]"}], "\[RuleDelayed]", 
              RowBox[{"cap", "[", 
               RowBox[{
                RowBox[{"Sort", "[", "a", "]"}], ",", 
                RowBox[{"Sort", "[", "b", "]"}]}], "]"}]}]}], "/.", 
            "tocap2"}], "/.", "sortab"}], "/.", 
          RowBox[{
           RowBox[{"Qlog", "[", 
            RowBox[{"-", "x_"}], "]"}], "\[RuleDelayed]", 
           RowBox[{"Qlog", "[", "x", "]"}]}]}], "&"}], ",", "allpeiping"}], 
       "]"}]}], ";"}], "//", "AbsoluteTiming"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.803868204329136*^9, 3.8038682103048024`*^9}, {
   3.8038683467006087`*^9, 3.8038683840817933`*^9}, {3.803868558657439*^9, 
   3.803868560288274*^9}, {3.803868637487939*^9, 3.803868639110942*^9}, {
   3.8038688396344953`*^9, 3.8038689325133867`*^9}, {3.8038689838223705`*^9, 
   3.8038690403189692`*^9}, {3.803869298270854*^9, 3.803869310083528*^9}, {
   3.8038694325960727`*^9, 3.8038694405338745`*^9}, 3.803869542943585*^9, {
   3.803869810763121*^9, 3.8038698807311554`*^9}, {3.803869950550262*^9, 
   3.8038699531125517`*^9}, {3.8038699970472493`*^9, 3.8038700014733825`*^9}, 
   3.803870242525219*^9, {3.803870283022751*^9, 3.8038702880415783`*^9}, {
   3.8038703905374136`*^9, 3.803870417191413*^9}, {3.803870540279559*^9, 
   3.8038705682691803`*^9}, {3.803870828041298*^9, 3.803870834327798*^9}, {
   3.803870910280181*^9, 3.803870914870509*^9}, {3.803871192804452*^9, 
   3.8038712110028653`*^9}, {3.803875707909748*^9, 3.803875915353503*^9}, {
   3.8038765207766848`*^9, 3.8038765261555333`*^9}, {3.803876574219036*^9, 
   3.8038768053351545`*^9}, {3.803877230713747*^9, 3.8038772408668604`*^9}, {
   3.803877279597619*^9, 3.803877343520069*^9}, {3.803877551728717*^9, 
   3.8038775564123335`*^9}, {3.8038781632750764`*^9, 
   3.803878169940277*^9}},ExpressionUUID->"8228c597-12a9-406e-8e13-\
9a0008a1ee22"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"19.1627646`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.803876686625008*^9, 3.8038767150091543`*^9}, {
   3.8038767841296425`*^9, 3.803876795985397*^9}, 3.803877232761427*^9, {
   3.803877277711568*^9, 3.803877363374729*^9}, 3.8038775890951233`*^9},
 CellLabel->
  "Out[453]=",ExpressionUUID->"c8c33240-573c-4a19-a770-7f11ffd6a515"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"33.1907926`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{{3.803876686625008*^9, 3.8038767150091543`*^9}, {
   3.8038767841296425`*^9, 3.803876795985397*^9}, 3.803877232761427*^9, {
   3.803877277711568*^9, 3.803877363374729*^9}, 3.803877622286149*^9},
 CellLabel->
  "Out[454]=",ExpressionUUID->"a3ce09d3-873f-4108-bef3-e5d4824ff9bd"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{
    RowBox[{"cs", "=", 
     RowBox[{
      RowBox[{"Cases", "[", 
       RowBox[{"allpeiping", ",", "_c", ",", "Infinity"}], "]"}], "//", 
      "Union"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"coeffs", "=", 
     RowBox[{"Normal", "[", 
      RowBox[{"Last", "@", 
       RowBox[{"CoefficientArrays", "[", 
        RowBox[{"allpeiping", ",", "cs"}], "]"}]}], "]"}]}], ";"}], 
   "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"coeffs", "=", 
     RowBox[{"ParallelMap", "[", 
      RowBox[{
       RowBox[{
        RowBox[{
         RowBox[{"Collect", "[", 
          RowBox[{"#", ",", "_R"}], "]"}], "//.", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"Qlog", "[", "a_", "]"}], "+", 
             RowBox[{"Qlog", "[", "b_", "]"}]}], "\[RuleDelayed]", 
            RowBox[{"Qlog", "[", 
             RowBox[{"a", " ", "b"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{
             RowBox[{"Qlog", "[", "a_", "]"}], "-", 
             RowBox[{"Qlog", "[", "b_", "]"}]}], "\[RuleDelayed]", 
            RowBox[{"Qlog", "[", 
             RowBox[{"a", "/", "b"}], "]"}]}], ",", 
           RowBox[{
            RowBox[{"a_Integer", " ", 
             RowBox[{"Qlog", "[", "b_", "]"}]}], "\[RuleDelayed]", 
            RowBox[{"Qlog", "[", 
             RowBox[{"b", "^", "a"}], "]"}]}]}], "}"}]}], "&"}], ",", 
       "coeffs"}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"allpeiping", "=", 
     RowBox[{"cs", ".", "coeffs"}]}], ";"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.803877645572096*^9, 3.803877731729969*^9}, {
  3.8038778549365687`*^9, 3.8038778551746264`*^9}, {3.8038779828994017`*^9, 
  3.803877985334854*^9}, {3.8038780408333025`*^9, 3.803878047854901*^9}},
 CellLabel->
  "In[483]:=",ExpressionUUID->"2b952ae8-b0f3-4a15-839a-56ec380d142d"],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"allpeiping", ">>", "simallpeiping"}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.80387806853855*^9, 3.8038781106616697`*^9}},
 CellLabel->
  "In[488]:=",ExpressionUUID->"62a15aa9-16f4-4b9b-8b6e-545e7ed4cfc3"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"allcoeffs", "=", 
   RowBox[{"<<", "\"\<allcoeffs\>\""}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"allpeiping", "=", 
   RowBox[{"<<", "\"\<simallpeiping\>\""}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.8038781433816175`*^9, 3.803878183945155*^9}},
 CellLabel->"In[58]:=",ExpressionUUID->"f08e92d7-40db-4966-8f94-3ac75384fede"],

Cell[BoxData[
 RowBox[{
  RowBox[{"tempint", "[", "cab_", "]"}], ":=", 
  RowBox[{
   RowBox[{
    RowBox[{"Expand", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Expand", "[", 
         RowBox[{
          RowBox[{
           RowBox[{
            RowBox[{
             RowBox[{"(", 
              RowBox[{"cab", "/.", "allcoeffs"}], ")"}], "/.", 
             RowBox[{
              RowBox[{"log", "[", "x_", "]"}], "\[RuleDelayed]", 
              RowBox[{
               RowBox[{"logmonic", "[", "x", "]"}], "/;", 
               RowBox[{"!", 
                RowBox[{"FreeQ", "[", 
                 RowBox[{"x", ",", "\[Tau]"}], "]"}]}]}]}]}], "/.", 
            RowBox[{
             RowBox[{"log", "[", "1", "]"}], "->", "0"}]}], "/.", 
           RowBox[{
            RowBox[{"Li", "[", 
             RowBox[{"1", "-", "x_"}], "]"}], "\[RuleDelayed]", 
            RowBox[{
             RowBox[{"With", "[", 
              RowBox[{
               RowBox[{"{", 
                RowBox[{
                 RowBox[{"hh", "=", 
                  RowBox[{
                   RowBox[{
                    RowBox[{"(", 
                    RowBox[{
                    RowBox[{
                    RowBox[{"Together", "[", 
                    RowBox[{"1", "-", "x"}], "]"}], "//", "monic"}], "//", 
                    "Simplify"}], ")"}], "/.", "tocaps"}], "/.", "sortab"}]}],
                  ",", 
                 RowBox[{"jj", "=", 
                  RowBox[{"monic", "[", "x", "]"}]}]}], "}"}], ",", 
               RowBox[{
                RowBox[{"-", 
                 RowBox[{"ctensor", "[", 
                  RowBox[{
                   RowBox[{"jj", "[", 
                    RowBox[{"[", "1", "]"}], "]"}], ",", 
                   RowBox[{"hh", "[", 
                    RowBox[{"[", "1", "]"}], "]"}]}], "]"}]}], "-", 
                RowBox[{"ctensor", "[", 
                 RowBox[{
                  RowBox[{"jj", "[", 
                   RowBox[{"[", "1", "]"}], "]"}], ",", 
                  RowBox[{"hh", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}], "-", 
                RowBox[{"ctensor", "[", 
                 RowBox[{
                  RowBox[{"jj", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"hh", "[", 
                   RowBox[{"[", "1", "]"}], "]"}]}], "]"}], "-", 
                RowBox[{"ctensor", "[", 
                 RowBox[{
                  RowBox[{"jj", "[", 
                   RowBox[{"[", "2", "]"}], "]"}], ",", 
                  RowBox[{"hh", "[", 
                   RowBox[{"[", "2", "]"}], "]"}]}], "]"}]}]}], "]"}], "/;", 
             RowBox[{"!", 
              RowBox[{"FreeQ", "[", 
               RowBox[{"x", ",", "\[Tau]"}], "]"}]}]}]}]}], "/.", 
          RowBox[{"{", 
           RowBox[{
            RowBox[{
             RowBox[{"Li", "[", "1", "]"}], "\[RuleDelayed]", "0"}], ",", 
            RowBox[{
             RowBox[{"Li", "[", 
              RowBox[{"1", "-", "x_"}], "]"}], "\[RuleDelayed]", 
             RowBox[{"-", 
              RowBox[{"ctensor", "[", 
               RowBox[{"x", ",", 
                RowBox[{"1", "-", "x"}]}], "]"}]}]}]}], "}"}]}], "]"}], "/.", 
        RowBox[{
         RowBox[{"ctensor", "[", 
          RowBox[{"___", ",", 
           RowBox[{"1", "|", 
            RowBox[{"-", "1"}]}], ",", "___"}], "]"}], "\[RuleDelayed]", 
         "0"}]}], "/.", 
       RowBox[{
        RowBox[{
         RowBox[{"log", "[", "x_", "]"}], 
         RowBox[{"log", "[", "y_", "]"}]}], "\[RuleDelayed]", 
        RowBox[{
         RowBox[{"ctensor", "[", 
          RowBox[{"x", ",", "y"}], "]"}], "+", 
         RowBox[{"ctensor", "[", 
          RowBox[{"y", ",", "x"}], "]"}]}]}]}], "//.", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{
         RowBox[{"ctensor", "[", 
          RowBox[{"a___", ",", 
           RowBox[{"1", "/", 
            RowBox[{"(", 
             RowBox[{"\[Tau]", "+", "b_."}], ")"}]}], ",", "c___"}], "]"}], 
         "\[RuleDelayed]", 
         RowBox[{"-", 
          RowBox[{"ctensor", "[", 
           RowBox[{"a", ",", 
            RowBox[{"\[Tau]", "+", "b"}], ",", "c"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"ctensor", "[", 
          RowBox[{"a___", ",", 
           RowBox[{
            RowBox[{"(", 
             RowBox[{"\[Tau]", "+", "d_."}], ")"}], "/", 
            RowBox[{"(", 
             RowBox[{"\[Tau]", "+", "b_."}], ")"}]}], ",", "c___"}], "]"}], 
         "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"ctensor", "[", 
           RowBox[{"a", ",", 
            RowBox[{"\[Tau]", "+", "d"}], ",", "c"}], "]"}], "-", 
          RowBox[{"ctensor", "[", 
           RowBox[{"a", ",", 
            RowBox[{"\[Tau]", "+", "b"}], ",", "c"}], "]"}]}]}], ",", 
        RowBox[{
         RowBox[{"dlog", "[", 
          RowBox[{"x_", "/", "y_"}], "]"}], "\[RuleDelayed]", 
         RowBox[{
          RowBox[{"dlog", "[", "x", "]"}], "-", 
          RowBox[{"dlog", "[", "y", "]"}]}]}]}], "}"}]}], "]"}], "/.", 
    RowBox[{
     RowBox[{
      RowBox[{"dlog", "[", "x_", "]"}], 
      RowBox[{"ctensor", "[", "y__", "]"}]}], "\[RuleDelayed]", 
     RowBox[{"cint", "[", 
      RowBox[{
       RowBox[{"dlog", "[", "x", "]"}], 
       RowBox[{"ctensor", "[", "y", "]"}]}], "]"}]}]}], "/.", 
   RowBox[{
    RowBox[{"ctensor", "[", 
     RowBox[{"___", ",", 
      RowBox[{"1", "|", 
       RowBox[{"-", "1"}], "|", "0"}], ",", "___"}], "]"}], "\[RuleDelayed]", 
    "0"}]}]}]], "Input",
 CellChangeTimes->{{3.804850070894049*^9, 3.8048501006687403`*^9}, {
   3.8048503954428816`*^9, 3.8048504036435547`*^9}, 3.8048504345236454`*^9, {
   3.804850728953129*^9, 3.804850744002531*^9}, 3.8048518079677505`*^9},
 CellLabel->
  "In[816]:=",ExpressionUUID->"f83fd2ef-e00b-4ffa-9c42-842bca51ae0a"],

Cell[CellGroupData[{

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"newcoeffs", "=", 
    RowBox[{"Table", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"c", "[", 
        RowBox[{
         RowBox[{"ab", "[", "1", "]"}], ",", "i"}], "]"}], "->", 
       RowBox[{"tempint", "[", 
        RowBox[{"c", "[", 
         RowBox[{
          RowBox[{"ab", "[", "1", "]"}], ",", "i"}], "]"}], "]"}]}], ",", 
      RowBox[{"{", 
       RowBox[{"i", ",", "1270"}], "}"}]}], "]"}]}], ";"}], "//", 
  "AbsoluteTiming"}]], "Input",
 CellChangeTimes->{{3.80485002140981*^9, 3.8048500560390553`*^9}, {
   3.8048501111483064`*^9, 3.804850134823533*^9}, {3.8048502249137697`*^9, 
   3.8048502271393604`*^9}, {3.8048504512903695`*^9, 3.8048504739535723`*^9}, 
   3.8048505117959857`*^9},
 CellLabel->
  "In[817]:=",ExpressionUUID->"d5145d28-8e02-47e8-bf99-37bb57304e1a"],

Cell[BoxData[
 RowBox[{"{", 
  RowBox[{"15.4330134`", ",", "Null"}], "}"}]], "Output",
 CellChangeTimes->{
  3.804850457574223*^9, {3.8048505038529034`*^9, 3.80485052868322*^9}, 
   3.804851781765051*^9, 3.8048518268517246`*^9},
 CellLabel->
  "Out[817]=",ExpressionUUID->"abce0125-0f30-4050-a939-b299b78ea5d5"]
}, Open  ]],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{
    RowBox[{"Compress", "[", "newcoeffs", "]"}], ">>", "newcoeffs"}], ";"}], 
  " ", "*)"}]], "Input",
 CellChangeTimes->{{3.804850804794635*^9, 3.8048508091426625`*^9}, {
  3.8048508873017673`*^9, 3.8048509154366913`*^9}, {3.804851187523325*^9, 
  3.804851190732388*^9}},ExpressionUUID->"07ba0f9a-7386-4427-a153-\
210ed985d1ef"],

Cell[BoxData[
 RowBox[{
  RowBox[{"newcoeffs", "=", 
   RowBox[{"Uncompress", "[", 
    RowBox[{"<<", "newcoeffs"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.8048509168579903`*^9, 3.8048509503911114`*^9}, 
   3.804850989299879*^9},ExpressionUUID->"7ae58650-5a7a-4f86-b52f-\
3eed29b7333c"]
},
WindowSize->{796.875, 744.75},
WindowMargins->{{Automatic, 54.75}, {Automatic, 27.75}},
TaggingRules->{"TryRealOnly" -> False},
FrontEndVersion->"12.1 for Microsoft Windows (64-bit) (March 14, 2020)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"c619f729-d296-4b9c-87d8-4fc367797bb7"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[558, 20, 929, 22, 120, "Code",ExpressionUUID->"769c0147-5afc-472b-a0ef-dcc203a2118d",
 InitializationCell->True],
Cell[1490, 44, 53646, 1390, 814, "Code",ExpressionUUID->"c366fc84-ca3b-4de0-96ee-a68c69272ca4",
 InitializationCell->True],
Cell[55139, 1436, 5667, 171, 224, "Code",ExpressionUUID->"838cf258-cadd-4a1e-a8d1-8b5c3b683cd1"],
Cell[60809, 1609, 7377, 197, 259, "Code",ExpressionUUID->"f3f4a160-dda7-4e3a-b99a-400307eef730"],
Cell[68189, 1808, 8298, 220, 226, "Code",ExpressionUUID->"70e1b683-2e8b-49b0-ab4b-deb62c9c17de"],
Cell[CellGroupData[{
Cell[76512, 2032, 5030, 117, 240, "Input",ExpressionUUID->"8228c597-12a9-406e-8e13-9a0008a1ee22"],
Cell[81545, 2151, 385, 7, 32, "Output",ExpressionUUID->"c8c33240-573c-4a19-a770-7f11ffd6a515"],
Cell[81933, 2160, 383, 7, 32, "Output",ExpressionUUID->"a3ce09d3-873f-4108-bef3-e5d4824ff9bd"]
}, Open  ]],
Cell[82331, 2170, 1925, 51, 144, "Input",ExpressionUUID->"2b952ae8-b0f3-4a15-839a-56ec380d142d"],
Cell[84259, 2223, 265, 6, 28, "Input",ExpressionUUID->"62a15aa9-16f4-4b9b-8b6e-545e7ed4cfc3"],
Cell[84527, 2231, 377, 8, 48, "Input",ExpressionUUID->"f08e92d7-40db-4966-8f94-3ac75384fede"],
Cell[84907, 2241, 5846, 153, 242, "Input",ExpressionUUID->"f83fd2ef-e00b-4ffa-9c42-842bca51ae0a"],
Cell[CellGroupData[{
Cell[90778, 2398, 834, 22, 28, "Input",ExpressionUUID->"d5145d28-8e02-47e8-bf99-37bb57304e1a"],
Cell[91615, 2422, 311, 7, 32, "Output",ExpressionUUID->"abce0125-0f30-4050-a939-b299b78ea5d5"]
}, Open  ]],
Cell[91941, 2432, 387, 9, 28, "Input",ExpressionUUID->"07ba0f9a-7386-4427-a153-210ed985d1ef"],
Cell[92331, 2443, 295, 7, 28, "Input",ExpressionUUID->"7ae58650-5a7a-4f86-b52f-3eed29b7333c"]
}
]
*)

